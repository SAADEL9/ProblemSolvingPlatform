@page
@model ProblemSolvingPlatform.Areas.Identity.Pages.Account.ChangePasswordModel
@{
    ViewData["Title"] = "Change Password";
    Layout = "/Views/Shared/_Layout.cshtml";
}

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-6">
            <!-- Header -->
            <div class="mb-4">
                <a asp-page="./Profile" class="btn btn-outline-secondary mb-3">
                    <i class="bi bi-arrow-left"></i> Back to Profile
                </a>
                <h1 class="fw-bold">
                    <i class="bi bi-shield-lock"></i> Change Password
                </h1>
                <p class="text-muted">Update your account password to keep it secure</p>
            </div>

            <!-- Success Message -->
            @if (TempData["SuccessMessage"] != null)
            {
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                    <i class="bi bi-check-circle-fill"></i> @TempData["SuccessMessage"]
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            }

            <!-- Error Messages -->
            @if (Model.ErrorMessage != null)
            {
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    <i class="bi bi-exclamation-triangle-fill"></i> @Model.ErrorMessage
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            }

            <!-- Password Requirements Alert -->
            <div class="alert alert-info mb-4">
                <h6 class="alert-heading mb-2">
                    <i class="bi bi-info-circle"></i> Password Requirements
                </h6>
                <ul class="mb-0 small">
                    <li>At least 8 characters long</li>
                    <li>Contains uppercase letters (A-Z)</li>
                    <li>Contains lowercase letters (a-z)</li>
                    <li>Contains numbers (0-9)</li>
                    <li>Contains special characters (!@@#$%^&*)</li>
                </ul>
            </div>

            <!-- Change Password Form -->
            <form method="post" class="needs-validation" novalidate>
                <div class="card shadow-sm border-0">
                    <div class="card-body p-4">
                        <!-- Current Password -->
                        <div class="mb-4">
                            <label for="currentPassword" class="form-label fw-semibold">
                                <i class="bi bi-lock"></i> Current Password
                            </label>
                            <input asp-for="Input.CurrentPassword" type="password" class="form-control form-control-lg" placeholder="Enter your current password" required />
                            <span asp-validation-for="Input.CurrentPassword" class="text-danger small d-block mt-1"></span>
                        </div>

                        <!-- New Password -->
                        <div class="mb-4">
                            <label for="newPassword" class="form-label fw-semibold">
                                <i class="bi bi-key"></i> New Password
                            </label>
                            <div class="input-group input-group-lg">
                                <input asp-for="Input.NewPassword" id="newPassword" type="password" class="form-control" placeholder="Enter your new password" required />
                                <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('newPassword')">
                                    <i class="bi bi-eye"></i>
                                </button>
                            </div>
                            <small class="text-muted d-block mt-2">Make sure your new password is different from your current password</small>
                            <span asp-validation-for="Input.NewPassword" class="text-danger small d-block mt-1"></span>
                        </div>

                        <!-- Confirm Password -->
                        <div class="mb-4">
                            <label for="confirmPassword" class="form-label fw-semibold">
                                <i class="bi bi-key"></i> Confirm New Password
                            </label>
                            <div class="input-group input-group-lg">
                                <input asp-for="Input.ConfirmPassword" id="confirmPassword" type="password" class="form-control" placeholder="Confirm your new password" required />
                                <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('confirmPassword')">
                                    <i class="bi bi-eye"></i>
                                </button>
                            </div>
                            <span asp-validation-for="Input.ConfirmPassword" class="text-danger small d-block mt-1"></span>
                        </div>

                        <!-- Password Strength Indicator -->
                        <div class="mb-4">
                            <label class="form-label fw-semibold">Password Strength</label>
                            <div class="progress" style="height: 8px;">
                                <div id="passwordStrength" class="progress-bar" role="progressbar" style="width: 0%; background-color: #dc3545;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <small id="strengthText" class="text-danger d-block mt-1">Enter a password to see strength</small>
                        </div>
                    </div>

                    <!-- Buttons -->
                    <div class="card-footer bg-white border-top d-flex gap-2">
                        <button type="submit" class="btn btn-success btn-lg flex-grow-1">
                            <i class="bi bi-check-circle"></i> Change Password
                        </button>
                        <a asp-page="./Profile" class="btn btn-outline-secondary btn-lg flex-grow-1">
                            <i class="bi bi-x-circle"></i> Cancel
                        </a>
                    </div>
                </div>
            </form>

            <!-- Password Tips -->
            <div class="card shadow-sm border-0 mt-4">
                <div class="card-header bg-white border-bottom">
                    <h6 class="mb-0">
                        <i class="bi bi-lightbulb"></i> Password Tips
                    </h6>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled mb-0">
                        <li class="mb-2">
                            <i class="bi bi-check-circle text-success"></i>
                            <small>Use a combination of uppercase, lowercase, numbers, and symbols</small>
                        </li>
                        <li class="mb-2">
                            <i class="bi bi-check-circle text-success"></i>
                            <small>Avoid using personal information like your name or birthday</small>
                        </li>
                        <li class="mb-2">
                            <i class="bi bi-check-circle text-success"></i>
                            <small>Don't reuse passwords from other accounts</small>
                        </li>
                        <li>
                            <i class="bi bi-check-circle text-success"></i>
                            <small>Change your password regularly for better security</small>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .form-control-lg,
    .input-group-lg .form-control {
        font-size: 1rem;
        padding: 0.75rem 1rem;
    }

    .form-label {
        margin-bottom: 0.5rem;
        color: #333;
    }

    .input-group .btn {
        border-color: #dee2e6;
    }

    .input-group .btn:hover {
        background-color: #f8f9fa;
    }

    .progress {
        background-color: #f0f0f0;
        border-radius: 4px;
        overflow: hidden;
    }

    .card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
    }

    .alert {
        border-radius: 0.5rem;
    }

    .list-unstyled li {
        padding: 0.25rem 0;
    }
</style>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}

<script>
    // Password strength indicator
    document.getElementById('newPassword').addEventListener('input', function() {
        const password = this.value;
        let strength = 0;
        let text = 'Weak';
        let color = '#dc3545'; // Red

        if (password.length >= 8) strength += 20;
        if (password.match(/[a-z]/)) strength += 20;
        if (password.match(/[A-Z]/)) strength += 20;
        if (password.match(/[0-9]/)) strength += 20;
        if (password.match(/[!@@#$%^&*]/)) strength += 20;

        if (strength <= 40) {
            text = 'Weak';
            color = '#dc3545';
        } else if (strength <= 60) {
            text = 'Fair';
            color = '#ffc107';
        } else if (strength <= 80) {
            text = 'Good';
            color = '#17a2b8';
        } else {
            text = 'Strong';
            color = '#28a745';
        }

        const progressBar = document.getElementById('passwordStrength');
        progressBar.style.width = strength + '%';
        progressBar.style.backgroundColor = color;
        
        const strengthText = document.getElementById('strengthText');
        strengthText.textContent = 'Password strength: ' + text;
        strengthText.style.color = color;
    });

    // Toggle password visibility
    function togglePassword(fieldId) {
        const field = document.getElementById(fieldId);
        if (field.type === 'password') {
            field.type = 'text';
        } else {
            field.type = 'password';
        }
    }
</script>
