@model IEnumerable<ProblemSolvingPlatform.Models.Probleme>
@using Microsoft.AspNetCore.Identity
@inject SignInManager<ProblemSolvingPlatform.Models.User> SignInManager
@inject UserManager<ProblemSolvingPlatform.Models.User> UserManager

@{
    ViewData["Title"] = "Problems List";
    var isAdmin = User.IsInRole("Admin");
}

<div class="container-fluid py-5" style="background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); min-height: 200px; border-radius: 0 0 2rem 2rem;">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="fw-bold text-white mb-2 display-5 shadow-sm">
                    <i class="bi bi-code-square me-2"></i> Challenges
                </h1>
                <p class="text-white-50 fs-5">Sharpen your skills with curated coding problems</p>
            </div>
            <div class="col-md-4 text-md-end">
                @if (isAdmin)
                {
                    <a asp-action="Create" class="btn btn-white btn-lg rounded-pill px-4 shadow-lg text-primary fw-bold">
                        <i class="bi bi-plus-circle me-1"></i> Create Problem
                    </a>
                }
            </div>
        </div>
    </div>
</div>

<div class="container py-5">
    <div class="container">
        <div class="row g-4">
            @if (Model.Any())
            {
                @foreach (var item in Model)
                {
                    <div class="col-lg-6 col-xl-4">
                        <div class="card bg-dark border-secondary h-100 problem-card shadow-sm" style="transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; border-radius: 1rem;">
                            <div class="card-body d-flex flex-column p-4">
                                <div class="d-flex justify-content-between align-items-start mb-3">
                                    <h5 class="card-title fw-bold text-white mb-0">
                                        @Html.DisplayFor(modelItem => item.Title)
                                    </h5>
                                    <span class="badge rounded-pill
                                        @(item.Difficulte == "Easy" ? "bg-success-subtle text-success border border-success" :
                                          item.Difficulte == "Medium" ? "bg-warning-subtle text-warning border border-warning" :
                                          "bg-danger-subtle text-danger border border-danger")" style="font-size: 0.75rem; padding: 0.5em 1em;">
                                        @item.Difficulte
                                    </span>
                                </div>
    
                                <p class="text-white-50 flex-grow-1 mb-4" style="font-size: 0.95rem; line-height: 1.6;">
                                    @{
                                        var description = item.Descr ?? "";
                                        if (description.Length > 120)
                                        {
                                            @(description.Substring(0, 120) + "...")
                                        }
                                        else
                                        {
                                            @description
                                        }
                                    }
                                </p>
    
                                <div class="d-flex align-items-center mb-4 text-secondary small">
                                    <span class="me-3"><i class="bi bi-hash me-1"></i> #@item.ProbId</span>
                                    <span><i class="bi bi-person-check me-1"></i> 256 Solved</span>
                                </div>
    
                                <div class="d-flex gap-2 mt-auto">
                                    <a asp-action="Details" asp-route-id="@item.ProbId" class="btn btn-primary flex-grow-1 rounded-pill fw-bold">
                                        <i class="bi bi-terminal me-1"></i> Solve Challenge
                                    </a>
                                    @if (isAdmin)
                                    {
                                        <a asp-action="Edit" asp-route-id="@item.ProbId" class="btn btn-outline-secondary rounded-circle" style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;">
                                            <i class="bi bi-pencil"></i>
                                        </a>
                                        <a asp-action="Delete" asp-route-id="@item.ProbId" class="btn btn-outline-danger rounded-circle" style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;">
                                            <i class="bi bi-trash"></i>
                                        </a>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="col-12">
                    <div class="text-center py-5 rounded-4 bg-dark border border-secondary shadow-sm">
                        <i class="bi bi-inbox text-secondary" style="font-size: 4rem;"></i>
                        <h4 class="text-white mt-4">No Challenges Found</h4>
                        <p class="text-white-50">Check back later or create a new challenge if you're an admin.</p>
                        @if (isAdmin)
                        {
                            <a asp-action="Create" class="btn btn-primary mt-3 rounded-pill px-4">
                                <i class="bi bi-plus-circle me-1"></i> Create First Problem
                            </a>
                        }
                    </div>
                </div>
            }
        </div>
    </div>
</div>

<style>
    .problem-card:hover {
        transform: translateY(-10px);
        border-color: #6366f1 !important;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5), 0 10px 10px -5px rgba(99, 102, 241, 0.2) !important;
    }

    .btn-primary {
        background: #6366f1;
        border: none;
    }

    .btn-primary:hover {
        background: #4f46e5;
    }

    .btn-white {
        background: white;
        border: 1px solid white;
    }
    
    .btn-white:hover {
        background: rgba(255, 255, 255, 0.9);
        color: #4f46e5;
    }

    .bg-success-subtle { background: rgba(22, 163, 74, 0.1) !important; }
    .bg-warning-subtle { background: rgba(202, 138, 4, 0.1) !important; }
    .bg-danger-subtle { background: rgba(220, 38, 38, 0.1) !important; }
</style>
